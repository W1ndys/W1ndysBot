# 舆情监控模块 (SentimentAnalysis)

## 功能介绍

舆情监控模块使用LTP+BERT模型接入硅基流动的API进行情绪推理，当检测到负面情绪的消息时会自动撤回该消息，并通知发送者。

## 配置说明

模块的配置文件位于 `modules/SentimentAnalysis/config.py`，包含以下配置项：

- `SIJI_BASE_URL`: 硅基流动API的基础URL
- `SIJI_API_KEY`: API访问密钥
- `SIJI_MODEL_NAME`: 使用的模型名称
- `NEGATIVE_SENTIMENT_THRESHOLD`: 负面情绪判断阈值（0-1之间）
- `REQUEST_TIMEOUT`: API请求超时时间（秒）
- `AUTO_DELETE_NEGATIVE_MSG`: 是否自动删除负面情绪消息
- `ADMIN_NOTIFICATION`: 是否通知管理员

## 命令列表

1. `SA` - 切换舆情监控模块开关状态（开启/关闭）
2. `设置情绪阈值 [数值]` - 设置负面情绪判断阈值，数值应在0-1之间

## 使用方法

### 模块开关控制

- 发送 `SA` 命令可以切换舆情监控模块的开关状态
- 只有管理员或系统管理员可以在群内使用此命令
- 系统管理员可以在私聊中使用此命令控制全局开关

### 情绪阈值设置

- 发送 `设置情绪阈值 0.7` 可以设置负面情绪判断阈值
- 数值范围应在0-1之间，数值越低表示判定为负面情绪的标准越严格
- 只有管理员或系统管理员可以设置阈值

### 自动监控

当模块处于开启状态时，会自动监控群内消息，每条消息都会进行情绪分析，并将分析结果记录到日志文件中。当日志检测到负面情绪且置信度超过设定阈值时：
1. 自动撤回该消息
2. 通知发送者消息已被撤回及原因
3. 记录相关日志供后续分析

## 日志文件

所有消息的情绪分析结果都会被记录在 `data/SentimentAnalysis/sentiment_analysis_log.txt` 文件中，包括：
- 消息发送的群号和用户信息
- 消息内容
- 情绪分析结果（正面/负面/中性）
- 置信度分数

## 注意事项

1. 请确保正确配置了硅基流动的API密钥和相关参数
2. 模块不会对管理员发送的消息进行情绪分析
3. 可以为不同群组设置不同的阈值和启用状态